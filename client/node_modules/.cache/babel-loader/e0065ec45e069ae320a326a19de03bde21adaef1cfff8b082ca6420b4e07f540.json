{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createPathRewriter = void 0;\nconst isPlainObj = require(\"is-plain-obj\");\nconst errors_1 = require(\"./errors\");\nconst logger_1 = require(\"./logger\");\nconst logger = (0, logger_1.getInstance)();\n/**\n * Create rewrite function, to cache parsed rewrite rules.\n *\n * @param {Object} rewriteConfig\n * @return {Function} Function to rewrite paths; This function should accept `path` (request.url) as parameter\n */\nfunction createPathRewriter(rewriteConfig) {\n  let rulesCache;\n  if (!isValidRewriteConfig(rewriteConfig)) {\n    return;\n  }\n  if (typeof rewriteConfig === 'function') {\n    const customRewriteFn = rewriteConfig;\n    return customRewriteFn;\n  } else {\n    rulesCache = parsePathRewriteRules(rewriteConfig);\n    return rewritePath;\n  }\n  function rewritePath(path) {\n    let result = path;\n    for (const rule of rulesCache) {\n      if (rule.regex.test(path)) {\n        result = result.replace(rule.regex, rule.value);\n        logger.debug('[HPM] Rewriting path from \"%s\" to \"%s\"', path, result);\n        break;\n      }\n    }\n    return result;\n  }\n}\nexports.createPathRewriter = createPathRewriter;\nfunction isValidRewriteConfig(rewriteConfig) {\n  if (typeof rewriteConfig === 'function') {\n    return true;\n  } else if (isPlainObj(rewriteConfig)) {\n    return Object.keys(rewriteConfig).length !== 0;\n  } else if (rewriteConfig === undefined || rewriteConfig === null) {\n    return false;\n  } else {\n    throw new Error(errors_1.ERRORS.ERR_PATH_REWRITER_CONFIG);\n  }\n}\nfunction parsePathRewriteRules(rewriteConfig) {\n  const rules = [];\n  if (isPlainObj(rewriteConfig)) {\n    for (const [key] of Object.entries(rewriteConfig)) {\n      rules.push({\n        regex: new RegExp(key),\n        value: rewriteConfig[key]\n      });\n      logger.info('[HPM] Proxy rewrite rule created: \"%s\" ~> \"%s\"', key, rewriteConfig[key]);\n    }\n  }\n  return rules;\n}","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}